{% extends 'base.html' %}

{% block title %}–î–∏–Ω–∞–º–∏–∫–∞ –ª–∏—á–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤ - –û—Ç—á—ë—Ç—ã{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üèÜ –î–∏–Ω–∞–º–∏–∫–∞ –ª–∏—á–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤</h1>
    <p class="subtitle">–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º</p>
</div>

<!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<div class="filter-card">
    <h2>–§–∏–ª—å—Ç—Ä—ã –æ—Ç—á—ë—Ç–∞</h2>
    <form method="GET" action="{{ url_for('reports.records') }}" class="filter-form">
        <div class="form-row">
            <div class="form-group">
                <label for="exercise_id">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <select id="exercise_id" name="exercise_id">
                    <option value="">–í—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</option>
                    {% for exercise in all_exercises %}
                    <option value="{{ exercise.id }}"
                            {% if selected_exercise_id == exercise.id %}selected{% endif %}>
                        {{ exercise.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            <a href="{{ url_for('reports.records') }}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
    </form>
</div>

<!-- –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–∞ -->
<div class="formulas-card">
    <h3>üìê –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–∞</h3>
    <ul class="formulas-list">
        <li><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å (1RM):</strong> max(weight) - –Ω–∞–∏–±–æ–ª—å—à–∏–π –≤–µ—Å —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö –ø–æ–¥—Ö–æ–¥–æ–≤</li>
        <li><strong>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä—ë–º:</strong> max(sets √ó reps √ó weight) - –Ω–∞–∏–±–æ–ª—å—à–∏–π –æ–±—ä—ë–º –∑–∞ –æ–¥–Ω—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</li>
        <li><strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> ((–ø–æ—Å–ª–µ–¥–Ω–∏–π_–º–∞–∫—Å - –ø–µ—Ä–≤—ã–π_–º–∞–∫—Å) / –ø–µ—Ä–≤—ã–π_–º–∞–∫—Å) √ó 100% - –ø—Ä–æ—Ü–µ–Ω—Ç —É–ª—É—á—à–µ–Ω–∏—è</li>
    </ul>
</div>

<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç—á—ë—Ç–∞ -->
{% if report_data %}
<div class="results-section">
    <div class="results-header">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç—á—ë—Ç–∞</h2>
        <div class="export-buttons">
            <a href="{{ url_for('reports.records', exercise_id=selected_exercise_id, export='csv') }}"
               class="btn btn-export">
                üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
            </a>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div class="table-container">
        <table class="report-table">
            <thead>
                <tr>
                    <th>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</th>
                    <th>–ü–µ—Ä–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</th>
                    <th>–ü–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</th>
                    <th>–ú–∞–∫—Å –≤–µ—Å (–∫–≥)</th>
                    <th>–ú–∞–∫—Å –æ–±—ä—ë–º (–∫–≥)</th>
                    <th>–ü—Ä–æ–≥—Ä–µ—Å—Å (%)</th>
                </tr>
            </thead>
            <tbody>
                {% for row in report_data %}
                <tr>
                    <td><strong>{{ row.exercise_name }}</strong></td>
                    <td>{{ row.first_workout.strftime('%d.%m.%Y') }}</td>
                    <td>{{ row.last_workout.strftime('%d.%m.%Y') }}</td>
                    <td class="number">{{ row.max_weight }}</td>
                    <td class="number">{{ row.max_volume }}</td>
                    <td class="number progress-cell">
                        <span class="progress-badge {% if row.progress > 0 %}positive{% elif row.progress < 0 %}negative{% else %}neutral{% endif %}">
                            {% if row.progress > 0 %}‚Üó{% elif row.progress < 0 %}‚Üò{% else %}‚Üí{% endif %}
                            {{ row.progress }}%
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="results-summary">
        <p>–ù–∞–π–¥–µ–Ω–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π: <strong>{{ report_data | length }}</strong></p>
        <p>–°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å: <strong>{{ (report_data | sum(attribute='progress') / report_data | length) | round(2) }}%</strong></p>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
    <div class="progress-stats">
        <div class="stat-card positive-card">
            <div class="stat-icon">‚Üó</div>
            <div class="stat-content">
                <div class="stat-value">{{ report_data | selectattr('progress', 'gt', 0) | list | length }}</div>
                <div class="stat-label">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º</div>
            </div>
        </div>
        <div class="stat-card neutral-card">
            <div class="stat-icon">‚Üí</div>
            <div class="stat-content">
                <div class="stat-value">{{ report_data | selectattr('progress', 'eq', 0) | list | length }}</div>
                <div class="stat-label">–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π</div>
            </div>
        </div>
        <div class="stat-card negative-card">
            <div class="stat-icon">‚Üò</div>
            <div class="stat-content">
                <div class="stat-value">{{ report_data | selectattr('progress', 'lt', 0) | list | length }}</div>
                <div class="stat-label">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Å —Ä–µ–≥—Ä–µ—Å—Å–æ–º</div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="no-data">
    <p>üì≠ –î–∞–Ω–Ω—ã–µ –æ –ª–∏—á–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–∞—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    <p class="hint">–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏</p>
</div>
{% endif %}

<div class="back-link">
    <a href="{{ url_for('reports.index') }}">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –æ—Ç—á—ë—Ç–æ–≤</a>
</div>

<style>
.page-header {
    text-align: center;
    margin-bottom: 2rem;
}

.page-header h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: #333;
}

.subtitle {
    color: #666;
    font-size: 1rem;
}

.filter-card, .formulas-card, .results-section {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.filter-card h2, .formulas-card h3 {
    margin-bottom: 1rem;
    color: #333;
}

.filter-form .form-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #555;
}

.form-group select {
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
    background: white;
}

.form-group select:focus {
    outline: none;
    border-color: #4CAF50;
}

.form-actions {
    display: flex;
    gap: 1rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: background-color 0.2s;
}

.btn-primary {
    background-color: #4CAF50;
    color: white;
}

.btn-primary:hover {
    background-color: #45a049;
}

.btn-secondary {
    background-color: #757575;
    color: white;
}

.btn-secondary:hover {
    background-color: #616161;
}

.btn-export {
    background-color: #2196F3;
    color: white;
}

.btn-export:hover {
    background-color: #1976D2;
}

.formulas-list {
    list-style: none;
    padding: 0;
}

.formulas-list li {
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background: #f5f5f5;
    border-left: 4px solid #4CAF50;
    border-radius: 4px;
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.table-container {
    overflow-x: auto;
}

.report-table {
    width: 100%;
    border-collapse: collapse;
}

.report-table th,
.report-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.report-table th {
    background-color: #f5f5f5;
    font-weight: 600;
    color: #333;
}

.report-table tbody tr:hover {
    background-color: #f9f9f9;
}

.report-table td.number {
    text-align: right;
    font-family: 'Courier New', monospace;
}

.progress-cell {
    text-align: center !important;
}

.progress-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
}

.progress-badge.positive {
    background-color: #e8f5e9;
    color: #2e7d32;
}

.progress-badge.negative {
    background-color: #ffebee;
    color: #c62828;
}

.progress-badge.neutral {
    background-color: #f5f5f5;
    color: #757575;
}

.results-summary {
    margin-top: 1.5rem;
    padding-top: 1rem;
    border-top: 1px solid #ddd;
    text-align: right;
    color: #666;
}

.results-summary p {
    margin: 0.5rem 0;
}

.progress-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 2rem;
}

.stat-card {
    display: flex;
    align-items: center;
    padding: 1.5rem;
    border-radius: 8px;
    gap: 1rem;
}

.stat-card.positive-card {
    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
}

.stat-card.neutral-card {
    background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
}

.stat-card.negative-card {
    background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
}

.stat-icon {
    font-size: 2.5rem;
    opacity: 0.7;
}

.stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #333;
}

.stat-label {
    font-size: 0.9rem;
    color: #666;
}

.no-data {
    text-align: center;
    padding: 3rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.no-data p {
    font-size: 1.2rem;
    color: #666;
    margin-bottom: 0.5rem;
}

.no-data .hint {
    font-size: 1rem;
    color: #999;
}

.back-link {
    margin-top: 2rem;
    text-align: center;
}

.back-link a {
    color: #4CAF50;
    text-decoration: none;
    font-weight: 500;
}

.back-link a:hover {
    text-decoration: underline;
}
</style>
{% endblock %}
