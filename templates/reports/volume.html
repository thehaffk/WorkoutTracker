{% extends 'base.html' %}

{% block title %}–û–±—ä—ë–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥ - –û—Ç—á—ë—Ç—ã{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üìà –û–±—ä—ë–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥</h1>
    <p class="subtitle">–ê–Ω–∞–ª–∏–∑ –æ–±—ä—ë–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Å —Ä–∞—Å—á—ë—Ç–æ–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π</p>
</div>

<!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<div class="filter-card">
    <h2>–§–∏–ª—å—Ç—Ä—ã –æ—Ç—á—ë—Ç–∞</h2>
    <form method="GET" action="{{ url_for('reports.volume') }}" class="filter-form">
        <div class="form-row">
            <div class="form-group">
                <label for="date_from">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
                <input type="date" id="date_from" name="date_from" value="{{ date_from }}" required>
            </div>

            <div class="form-group">
                <label for="date_to">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                <input type="date" id="date_to" name="date_to" value="{{ date_to }}" required>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            <a href="{{ url_for('reports.volume') }}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
    </form>
</div>

<!-- –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–∞ -->
<div class="formulas-card">
    <h3>üìê –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–∞ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π</h3>
    <p style="margin-bottom: 1rem; color: #666; font-size: 0.95rem;">
        –í –¥–∞–Ω–Ω–æ–º –æ—Ç—á—ë—Ç–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ –∏—Ö —Ç–∏–ø–∞–º —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º
        —Å—É–º–º–∞—Ä–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    </p>
    <ul class="formulas-list">
        <li><strong>total_workouts = COUNT(workouts)</strong> - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏</li>
        <li><strong>total_duration = SUM(duration)</strong> - —Å—É–º–º–∞—Ä–Ω–∞—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –≤ –º–∏–Ω—É—Ç–∞—Ö</li>
        <li><strong>total_exercises = SUM(workout_exercises.sets * reps)</strong> - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</li>
        <li><strong>total_weight = SUM(workout_exercises.sets * reps * weight)</strong> - —Å—É–º–º–∞—Ä–Ω—ã–π –ø–æ–¥–Ω—è—Ç—ã–π –≤–µ—Å –≤ –∫–∏–ª–æ–≥—Ä–∞–º–º–∞—Ö</li>
    </ul>
</div>

<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç—á—ë—Ç–∞ -->
{% if report_data %}
<div class="results-section">
    <div class="results-header">
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç—á—ë—Ç–∞</h2>
        <div class="export-buttons">
            <a href="{{ url_for('reports.volume_export', date_from=date_from, date_to=date_to) }}"
               class="btn btn-export">
                üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
            </a>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div class="table-container">
        <table class="report-table">
            <thead>
                <tr>
                    <th>–¢–∏–ø —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</th>
                    <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</th>
                    <th>–û–±—â–µ–µ –≤—Ä–µ–º—è (–º–∏–Ω)</th>
                    <th>–í—Å–µ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π</th>
                    <th>–û–±—â–∏–π –≤–µ—Å (–∫–≥)</th>
                </tr>
            </thead>
            <tbody>
                {% for row in report_data %}
                <tr>
                    <td><strong>{{ row.workout_type }}</strong></td>
                    <td class="number">{{ row.total_workouts }}</td>
                    <td class="number">{{ row.total_duration }}</td>
                    <td class="number">{{ row.total_exercises }}</td>
                    <td class="number">{{ row.total_weight }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr class="total-row">
                    <td><strong>–ò–¢–û–ì–û:</strong></td>
                    <td class="number"><strong>{{ report_data | sum(attribute='total_workouts') }}</strong></td>
                    <td class="number"><strong>{{ report_data | sum(attribute='total_duration') }}</strong></td>
                    <td class="number"><strong>{{ report_data | sum(attribute='total_exercises') }}</strong></td>
                    <td class="number"><strong>{{ report_data | sum(attribute='total_weight') | round(2) }}</strong></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="results-summary">
        <p>–ù–∞–π–¥–µ–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: <strong>{{ report_data | length }}</strong></p>
    </div>
</div>
{% else %}
<div class="no-data">
    <p>üì≠ –ó–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
    <p class="hint">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</p>
</div>
{% endif %}

<div class="back-link">
    <a href="{{ url_for('reports.index') }}">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –æ—Ç—á—ë—Ç–æ–≤</a>
</div>

<style>
.page-header {
    text-align: center;
    margin-bottom: 2rem;
}

.page-header h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: #333;
}

.subtitle {
    color: #666;
    font-size: 1rem;
}

.filter-card, .formulas-card, .results-section {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.filter-card h2, .formulas-card h3 {
    margin-bottom: 1rem;
    color: #333;
}

.filter-form .form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #555;
}

.form-group input {
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
}

.form-group input:focus {
    outline: none;
    border-color: #4CAF50;
}

.form-actions {
    display: flex;
    gap: 1rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: background-color 0.2s;
}

.btn-primary {
    background-color: #4CAF50;
    color: white;
}

.btn-primary:hover {
    background-color: #45a049;
}

.btn-secondary {
    background-color: #757575;
    color: white;
}

.btn-secondary:hover {
    background-color: #616161;
}

.btn-export {
    background-color: #2196F3;
    color: white;
}

.btn-export:hover {
    background-color: #1976D2;
}

.formulas-list {
    list-style: none;
    padding: 0;
}

.formulas-list li {
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    background: #f5f5f5;
    border-left: 4px solid #4CAF50;
    border-radius: 4px;
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.table-container {
    overflow-x: auto;
}

.report-table {
    width: 100%;
    border-collapse: collapse;
}

.report-table th,
.report-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

.report-table th {
    background-color: #f5f5f5;
    font-weight: 600;
    color: #333;
}

.report-table tbody tr:hover {
    background-color: #f9f9f9;
}

.report-table td.number {
    text-align: right;
    font-family: 'Courier New', monospace;
}

.total-row {
    background-color: #e8f5e9 !important;
}

.total-row td {
    border-top: 2px solid #4CAF50;
    border-bottom: 2px solid #4CAF50;
}

.results-summary {
    margin-top: 1rem;
    text-align: right;
    color: #666;
}

.no-data {
    text-align: center;
    padding: 3rem;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.no-data p {
    font-size: 1.2rem;
    color: #666;
    margin-bottom: 0.5rem;
}

.no-data .hint {
    font-size: 1rem;
    color: #999;
}

.back-link {
    margin-top: 2rem;
    text-align: center;
}

.back-link a {
    color: #4CAF50;
    text-decoration: none;
    font-weight: 500;
}

.back-link a:hover {
    text-decoration: underline;
}
</style>
{% endblock %}
